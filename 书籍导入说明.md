# 书籍批量导入工具使用说明

## 概述

这个工具参考了 `initDB.py` 的设计，用于批量导入大量书籍数据到 MoYun 平台的数据库中。

## 功能特性

- 支持 CSV 和 JSON 格式的数据导入
- 自动数据验证和清理
- 重复数据检测，避免重复导入
- 详细的导入结果统计
- 内置示例数据

## 使用方法

### 1. 运行导入工具

```bash
python import_books.py
```

### 2. 选择导入方式

工具会显示菜单，支持以下选项：
- 1: 从 CSV 文件导入
- 2: 从 JSON 文件导入
- 3: 导入示例书籍数据
- 4: 显示帮助信息
- 0: 退出

## 数据格式要求

### 必填字段
- `isbn`: ISBN 编号（唯一）
- `title`: 书名
- `author`: 作者

### 可选字段
- `origin_title`: 原作名
- `subtitle`: 副标题
- `page`: 页数（整数）
- `publish_date`: 出版日期（格式：YYYY-MM-DD）
- `publisher`: 出版社
- `description`: 书籍简介
- `douban_score`: 豆瓣评分（0-10）
- `douban_id`: 豆瓣ID
- `bangumi_score`: Bangumi评分（0-10）
- `bangumi_id`: BangumiID
- `type`: 书籍类型（见下方支持的类型）

### 支持的书籍类型

根据《中国图书馆图书分类法》，支持以下22个基本大类：

1. 马列主义、毛泽东思想、邓小平理论
2. 哲学、宗教
3. 社会科学总论
4. 政治、法律
5. 军事
6. 经济
7. 文化、科学、教育、体育
8. 语言、文字
9. 文学
10. 艺术
11. 历史、地理
12. 自然科学总论
13. 数理科学和化学
14. 天文学、地球科学
15. 生物科学
16. 医药、卫生
17. 农业科学
18. 工业技术
19. 交通运输
20. 航空、航天
21. 环境科学、安全科学
22. 综合性图书

## CSV 文件格式

### 文件结构
```csv
isbn,title,origin_title,subtitle,author,page,publish_date,publisher,description,douban_score,douban_id,bangumi_score,bangumi_id,type
9787544270878,追风筝的人,The Kite Runner,,卡勒德·胡赛尼,362,2006-05-01,上海人民出版社,描述...,8.9,1770782,,,文学
```

### 注意事项
- 第一行必须是字段名（标题行）
- 支持逗号和分号作为分隔符
- 如果字段内容包含逗号，请用双引号包围
- 空字段可以留空，但不能省略逗号

## JSON 文件格式

### 格式一：书籍数组
```json
[
  {
    "isbn": "9787544291170",
    "title": "白夜行",
    "author": "东野圭吾",
    "page": 440,
    "type": "文学"
  }
]
```

### 格式二：包含 books 字段的对象
```json
{
  "books": [
    {
      "isbn": "9787544291170",
      "title": "白夜行",
      "author": "东野圭吾"
    }
  ]
}
```

## 数据验证规则

### 必填字段验证
- ISBN、标题、作者不能为空

### 数据类型验证
- 页数必须是整数
- 评分必须是 0-10 之间的数字
- 日期必须是 YYYY-MM-DD 格式

### 重复检测
- 通过 ISBN 检测重复
- 通过标题+作者组合检测重复

## 错误处理

### 数据验证错误
- 缺少必填字段：跳过该条记录
- 数据格式错误：自动修正或设为空值

### 数据库错误
- 连接失败：程序终止
- 插入失败：回滚事务，记录错误

## 示例文件

工具已创建了两个示例文件：
- `sample_books.csv`: CSV 格式示例
- `sample_books.json`: JSON 格式示例

## 配置要求

确保 `config.yaml` 文件中包含正确的数据库配置：

```yaml
Database:
  Host: localhost
  Port: 3306
  Account: your_username
  Password: your_password
  Database: your_database
```

## 运行结果

导入完成后，工具会显示：
- 成功导入的书籍数量
- 跳过的书籍数量（已存在）
- 失败的书籍数量（数据错误）

## 注意事项

1. **数据备份**：导入前请备份数据库
2. **网络连接**：确保数据库连接正常
3. **权限检查**：确保数据库用户有插入权限
4. **数据质量**：建议先用少量数据测试
5. **编码格式**：CSV 和 JSON 文件建议使用 UTF-8 编码

## 故障排除

### 常见问题

**Q: 数据库连接失败**
A: 检查 config.yaml 中的数据库配置和网络连接

**Q: 导入的书籍被跳过**
A: 可能是 ISBN 或标题+作者组合已存在，这是正常的重复检测

**Q: 某些字段显示为空**
A: 检查数据格式是否正确，不正确的数据会被自动清理

**Q: CSV 文件解析错误**
A: 确保文件编码为 UTF-8，分隔符正确，引号配对

## 技术支持

如有问题，请检查：
1. 数据库配置
2. 文件格式和编码
3. 必填字段是否完整
4. 数据类型是否正确

## 更新日志

- v1.0: 初始版本，支持 CSV 和 JSON 导入
- 支持数据验证和重复检测
- 包含示例数据和详细错误提示 